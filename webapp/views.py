# -*- coding: utf8 -*-
from django.template import  RequestContext
from django.template.loader import get_template
from django.shortcuts import render_to_response
from django.http import HttpResponse
from context_processors import custom_proc
# from multiprocessing.pool import worker
# from _mysql import result
import logging
logger = logging.getLogger("django")

#from pip.cmdoptions import src
#from cgitb import text

# Create your views here.
def hello(request):
#     logger.info('不要着急，该功能正在开发ing<br>：-)!')
    t=get_template("main.html")
    print t
    return HttpResponse("不要着急，该功能正在开发ing<br>：-)<br>")

def main(request):
    import py.mainpage,py.download_bing
    current_date,work = py.mainpage.mainpage()
    pic_url0,pic_url = py.download_bing.download_bing()
    return render_to_response('main.html',locals(),context_instance=RequestContext(request, processors=[custom_proc]))


def qrcode_form(request):
    import py.qrcode_transform
    errors = []
    result = False
    if request.method == 'GET':
        if not request.GET.get('code', ''):
            errors.append('请输入Json串!')
        if not errors:
            try:
                result = py.qrcode_transform.qrcode_transform(request.GET['code'])
                return render_to_response('qrcode_transform.html',locals(),context_instance=RequestContext(request, processors=[custom_proc]))
            except:
                errors.append('无效的字符串!')
    return render_to_response('qrcode_transform.html', locals(),context_instance=RequestContext(request, processors=[custom_proc]))
    
def json_formatting(request):
    from py.json_format import JsonFormatter
    errors = []
    if request.method == 'POST':
        if not request.POST.get('code', ''):
            errors.append('请输入Json串!')
#             return render_to_response('json_formatting.html', {'error': errors},context_instance=RequestContext(request, processors=[custom_proc]))
        if not errors:
            try:
                returnjson=JsonFormatter(source=request.POST['code']).render()
                return render_to_response('json_formatting.html',locals(),context_instance=RequestContext(request, processors=[custom_proc]))
            except:
                errors.append('无效的json串!')
#                 return render_to_response('json_formatting.html', {'error':errors},context_instance=RequestContext(request, processors=[custom_proc]))
    return render_to_response('json_formatting.html', {'error': errors},context_instance=RequestContext(request, processors=[custom_proc]))

def http_state(request):
    return render_to_response('http_state.html',context_instance=RequestContext(request, processors=[custom_proc]))

def log_out(request):
    import py.logout
    errors=[]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       
    if request.method == 'POST':
        if not request.POST.get('cellphone_no', ''):
            if not request.POST.get('id_no', ''):
                errors.append('请输入信息!')
        if not errors:
            try:
                returnresult=py.logout.lotout(request.POST.get('cellphone_no', ''),request.POST.get('id_no', ''))
                print request.POST.get('cellphone_no', '')+'    '+request.POST.get('id_no', '')
                if returnresult != '成功':
                    errors.append(returnresult)
                if not errors:
                    return render_to_response('log_out.html',{'returnresult': returnresult},context_instance=RequestContext(request, processors=[custom_proc]))
            except Exception,ex:
                print ex
                errors.append(ex)
    print errors
    return render_to_response('log_out.html', {'error': errors},context_instance=RequestContext(request, processors=[custom_proc]))
